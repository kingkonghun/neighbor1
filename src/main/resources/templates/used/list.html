<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Title</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
<script th:src="@{/js/jquery-3.6.3.min.js}" type="text/javascript"></script>
<link rel="stylesheet" th:href="@{/css/list.css}">
<style>
    body {
        background-color: #E6E6E6;
    }
</style>
<script th:inline="javascript">
    $(function (){
        let num = 0;
        $("#btnPlus").click(function (){
            num+=9;
            $.ajax({
                type: "get",
                url: "/used/list",
                data: {num:num, categoryId:$("#category_select").val()},
                success: function(data) {
                    $("#list").append(data);
                }
            });
        });

        $("#btnSubmit").click(function(){
            let category = $("#category");
            let price = $("#inputPrice");
            let content = $("#inputContent");
            let files = $("#files");
            if(category.val() == 0) {
                alert("카테고리를 선택하세요");
                category.focus();
                return;
            }
            if(price.val() == ''){
                alert("가격을 입력하세요");
                price.focus();
                return;
            }
            if (content.val() == "") {
                alert("내용을 입력하세요");
                content.focus();
                return;
            }
            if (files.val() == "") {
                alert("사진을 올려주세요");
                files.focus();
                return;
            }
            document.writeForm.submit();
        });
        $("#btnWrite").click(function (){
            $("#writeForm").slideDown();
        });
        $("#returnBtn").click(function (){
            $("#writeForm").slideUp();
        });
    });

    const inputPrice = document.getElementById("inputPrice");

    inputPrice.addEventListener("input", function(event) {
        // 입력된 값에서 숫자 이외의 문자 제거
        const formattedValue = this.value.replace(/\D/g, "");

        // 3자리마다 컴마 추가
        const numberWithCommas = formattedValue.replace(/\B(?=(\d{3})+(?!\d))/g, ",");

        // 값을 다시 설정하여 숫자 입력 필드에 반영
        this.value = numberWithCommas;
    });
</script>
</head>
<body>
<div th:replace="nav::nav"></div>

<header class="mt-5">
    <h1>중고거래</h1>
</header>

<section class="container mt-2">
    <div class="div_1 py-3">
        <article class="write">
            <button type="button" class="mb-3" id="btnWrite">글쓰기</button>
        </article>
        <article class="category">
            <select id="category_select" name="categoryId" onchange="location.href='/used/list?categoryId='+$('#category_select').val()">
                <option value="0">전체상품</option>
                <th:block th:each="category:${category}">
                    <option th:value="${category.categoryId}" th:text="${category.categoryName}" th:selected="${category.categoryId eq categoryId}"></option>
                </th:block>
            </select>
        </article>
    </div>
    <article th:include="used/post :: section" style="display: none;" id="writeForm"></article>


    <div id="list" class="row">
        <article class="col col-xl-4 col-lg-6 col-md-6 col-sm-12 pb-5" th:each="row : ${list}">
            <div class="item p-3" th:onclick="|location.href='@{detail(postId=${row.postId})}'|">
                <img class="list_img" th:src="@{/used/findImg(postId=${row.postId})}">
                <div class="div_2 mt-3">
                    <h5 th:text="${row.title}"></h5>
                    <span th:inline="text">
                        [[${row.postView}]]
                        <i class="bi bi-caret-up-fill"></i>
                    </span>

                </div>
                <div class="div_3">
                    <span class="price" th:inline="text">
                        [[${row.price}]] 원
                    </span>
                    <span th:inline="text">
                        20
                        <i class="bi bi-heart-fill" style="color: red"></i>
                    </span>
                </div>
                <div class="div_4">
                    <p th:text="${row.content}"></p>
                    <span th:inline="text">
                        30
                        <i class="bi bi-chat-dots-fill"></i>
                    </span>
                </div>
                <span th:text="${row.address}"></span>
            </div>
        </article>

    </div>
    <article class="col col-12 mb-5">
        <button type="button" id="btnPlus">더보기</button>
    </article>
</section>

<!-- Footer-->
<div th:replace="footer :: footer"></div>
</body>
</html>