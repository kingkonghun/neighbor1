<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <th:block th:insert="/common/common :: fragment-header"></th:block>
    <style>
    .container {padding-top: 50px; text-align: center; width: 100%;}

    #section_1 {width: 800px; margin: auto; border: 1px solid black; border-radius: 32px; box-shadow: 1px 1px 5px gray;}

    #img_1 {width: 100%; height: 500px; border-radius: 30px 30px 0px 0px;}

    table {width: 100%;}

    .text_div_1 {padding: 10px 20px;}

    .count_1 {font-size: 20px; font-weight: bold;}

    .p_price_1 {font-weight: bold;}

    #section_2 {width: 800px; margin: auto;}

    .article_list {padding-bottom: 30px;}
    .div_list:hover{ cursor: pointer;}

    .div_list {margin: 0 auto; width: 305px; border: 2px solid gray; border-radius: 32px; box-shadow: 1px 1px 5px gray;}

    .img_2 {width: 100%; height: 150px; border-radius: 30px 30px 0px 0px;}

    .text_div {padding: 10px 20px;}

    .p_title {font-size: 15px;}

    .p_price {font-weight: bold;}

    .p_address {font-size: 13px;}

    .count {font-weight: bold;}

    .article_2 {text-align: center;}
    .btnList {margin-bottom: 5em;}

    #btnWrite {border-radius: 10px; background-color: white; font-weight: bold; width: 60px; height: 40px; box-shadow: 1px 1px 5px gray;}

    #button_div {text-align: right;}
</style>
    <script>
    $(function(){
        list();
        $("#btnWrite").click(function(){
            var comment = $("#comment");
            if(comment.val() == ""){
                alert("내용을 입력하세요");
                comment.focus();
                return;
            }
            $.ajax({
                type: "post",
                url: "/reply/write",
                data: {postId: [[${dto.postId}]], comment: $("#comment").val()},
                success: function() {
                    alert("댓글을 작성했습니다");
                    $("#comment").val("");
                    list();
                }
            });
        });
    });
    function list() {
        $.ajax({
            type: "get",
            url: "/reply/list",
            data: {postId: [[${dto.postId}]]},
            success: function(result) {
                $("#replyList").html(result);
            }
        });
    }
    function deleteReply(replyId) {
        if(confirm("댓글을 삭제하시겠습니까?")) {
            $.ajax({
                type: "post",
                url: "/reply/delete",
                data: {replyId: replyId},
                success: function() {
                    list();
                }
            });
        }
    }
    function update(replyId) {
        $(".comment_"+replyId).css("display", "none");
        $(".buttonDiv_"+replyId).css("display", "none");
        $(".commentUpdate_"+replyId).show();
        $(".btnUpdateReply_"+replyId).show();
    }
    function updateReply(replyId) {
        var comment = $(".commentUpdate_"+replyId);
        if(comment.val() == "") {
            alert("내용을 입력하세요");
            comment.focus();
            return;
        }
        $.ajax({
            type: "post",
            url: "/reply/update",
            data: {replyId: replyId, comment: comment.val()},
            success: function() {
                list();
            }
        });
    }
    function reReply(replyId) {
        $(".buttonDiv_"+replyId).css("display", "none");
        $(".reComment_"+replyId).show();
        $(".btnReReply_"+replyId).show();
    }
    function writeReReply(replyId) {
        var comment = $(".reComment_"+replyId);
        if(comment.val() == "") {
            alert("내용을 입력하세요");
            comment.focus();
            return;
        }
        $.ajax({
            type: "post",
            url: "/reply/writeReReply",
            data: {replyId: replyId, comment: comment.val()},
            success: function() {
                list();
            }
        });
    }


</script>
</head>
<body>
<!-- Nav바-->
<div th:replace="nav :: nav"></div>

<div class="container">
    <section id="section_1">
        <article>
            <div>
<!--                                    <img id="img_1" th:src="@{/img/} + ${dto.productImage}" alt="">-->
            </div>
            <div class="text_div_1">
                <table>
                    <tr>
                        <td style="text-align: left;">
                            <h4 th:text="${dto.title}"></h4>
                            <span class="p_price_1" th:text="${dto.price}"></span>
                        </td>
                        <td style="text-align: right;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z" color="red"/>
                            </svg>
                            <span class="count_1" th:text="${dto.postView}"></span>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: left;"><p th:text="${dto.content}"></p></td>
                    </tr>
                    <tr>
                        <td colspan="2"><button type="button" id="btnEdit">수정</button></td>
                        <td colspan="2"><button type="button" id="btnDelete">삭제</button></td>
                    </tr>

                </table>
                <hr>
            </div>
        </article>
        <article style="margin: 20px;">
            <textarea rows="3" id="comment" style="width: 100%; border-radius: 30px; resize: none; padding: 20px;" placeholder="댓글 작성"></textarea>
            <div id="button_div">
                <button type="button" id="btnWrite">작성</button>
            </div>
        </article>
        <article id="replyList" style="margin: 20px;">

        </article>
    </section>

    <div th:include="used/edit :: section" style="display: none;" id="editForm"></div>

    <section id="section_2" class="row" style="margin-top: 30px;">
        <article style=" margin-bottom: 30px;">
            <span style="font-weight: bold; font-size: 30px;">비슷한 상품</span>
        </article>

        <article class="article_list col-lg-6 col-md-6 col-sm-12" th:each="row : ${similarList}">
            <div class="div_list" th:onclick="'location.href=\'' + @{detail(postId=${row.postId})} + '\''">
                <div>
                    <img class="img_2" th:src="@{/used/findImg(postId=${row.postId})}"  alt="실패">
                </div>
                <div class="text_div">
                    <table>
                        <tr>
                            <td style="text-align: left;">
                                <span class="p_title" th:text="${row.title}"></span> <br>
                                <span class="p_price" th:text="${row.price}"></span> <br>
                                <span class="p_address" th:text="${row.address}"></span>
                            </td>
                            <td style="text-align: right;">

                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z" color="red"/>
                                </svg>
                                <span class="count" th:text="${row.postView}"></span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </article>
        <div class="btnUsed" style="text-align: center;">
            <button class="btn btn-outline-secondary btnList" th:onclick="|location.href='@{/used/list}'|">중고상품 목록보기</button>
        </div>
    </section>

    <script th:inline="javascript">
        $(function (){
            $("#btnSubmit").click(function(){
                var category = $("#category");
                if(category.val() == 0) {
                    alert("카테고리를 선택하세요");
                    category.focus();
                    return;
                }
                document.writeForm.submit();
            });
            $("#btnEdit").click(function (){
                $("#editForm").slideDown();
            });
            $("#returnBtn").click(function (){
                $("#editForm").slideUp();
            });
            $("#btnDelete").click(function (){
                if(confirm("삭제하시겠습니까?")){
                location.href="/used/postDelete?postId="+[[${dto.postId}]];
                }
            });
        });
    </script>

    <script>
        const inputPrice = document.getElementById("inputPrice");

        inputPrice.addEventListener("input", function(event) {
            // 입력된 값에서 숫자 이외의 문자 제거
            const formattedValue = this.value.replace(/\D/g, "");

            // 3자리마다 컴마 추가
            const numberWithCommas = formattedValue.replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            // 값을 다시 설정하여 숫자 입력 필드에 반영
            this.value = numberWithCommas;
        });
    </script>

</div>
<div th:replace="footer :: footer"></div>
</body>
</html>
