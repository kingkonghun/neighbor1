<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>join</title>
    <th:block th:insert="/common/common :: fragment-header"></th:block>
    <link th:href="@{/css/login.css}" rel="stylesheet" type="text/css">

</head>
<body>
<section class="login-form">
    <h1>JOIN</h1>
    <form action="/member/join" method="post" name="form1" id="form1">
        <div class="int-area">
            <div class="email">
                <input type="email" name="memberEmail" id="memberEmail" autocomplete="off" required>
                <label for="memberEmail">MEMBER E-MAIL</label>
                <button type="button" id="btnAuthentication">
                    <i class="bi bi-bookmark-check"></i>
                </button>
            </div>
        </div>
        <div class="int-area">
            <input style="display: none;" type="text" name="random" id="random" required placeholder="메일에 전송된 문자 열을 입력 해 주세요.">
            <input type="hidden" name="random" id="authentication" required>
        </div>
        <div class="int-area">
            <input name="memberName" id="memberName" autocomplete="off" required>
            <label for="memberName">MEMBER NAME</label>
        </div>


        <div class="int-area">
            <input type="password" name="memberPWD" id="memberPWD" autocomplete="off" required>
            <label for="memberPWD">PASSWORD</label>
        </div>
        <div class="int-area">
            <input type="password"  id="passCheck" autocomplete="off" required>
            <label for="memberPWD">PASSCHECK</label>
        </div>

        <div class="int-area">
            <div class="address">
                <input type="text" name="address" id="address" autocomplete="off" required >
                <label for="address">ZIPCODE</label>
                <button type="button" onclick="zipcode()" id="btnSearch">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search-heart-fill" viewBox="0 0 16 16" color="#669900">
                        <path d="M6.5 13a6.474 6.474 0 0 0 3.845-1.258h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.008 1.008 0 0 0-.115-.1A6.471 6.471 0 0 0 13 6.5 6.502 6.502 0 0 0 6.5 0a6.5 6.5 0 1 0 0 13Zm0-8.518c1.664-1.673 5.825 1.254 0 5.018-5.825-3.764-1.664-6.69 0-5.018Z"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="int-area">
            <input type="text" name="addressDetail" id="addressDetail" autocomplete="off" required>
            <label for="addressDetail">ADDRESS</label>
        </div>

        <div class="btn-area">
            <button id="btnJoin" type="button">JOIN</button>
        </div>
    </form>
    <div class="caption">
        <a href="/login">Already have an ID?</a>
    </div>
</section>



<script th:inline="javascript">
    let memberEmail = $('#memberEmail');
    let memberName = $('#memberName');
    let memberPWD = $('#memberPWD');
    let passCheck = $('#passCheck');
    let address = $('#address');
    let addressDetail = $('#addressDetail');
    let btnJoin = $('#btnJoin');
    let btnAuthentication = $('#btnAuthentication');
    let authentication = $('#authentication');
    let random = $('#random');

    memberEmail.on('change', function () {
        memberEmail.removeClass('confirm');
        alert("이메일 인증 버튼을 눌러 주세요");
        memberEmail.focus();
    });


    $(btnAuthentication).on('click', function () {
        if(memberEmail.val() != '') {
            $.ajax({
                type: "post",
                url: "/member/emailConfirm",
                data: {memberEmail: memberEmail.val()},
                success: function (data) {
                    alert('메일이 전송 되었습니다.\n 메일을 확인해 주세요');
                    random.css({
                        'display': 'block'
                    });
                    authentication.val(data);
                    random.focus();
                    memberEmail.addClass('confirm');//이메일 인증완료 클래스
                }
            });
        }else alert('이메일을 입력해 주세요');
    });





    $(btnJoin).on('click', function (){
        if($(memberEmail).val() == ""){
            $(memberEmail).next('label').addClass('warning');
            setTimeout(function (){
                $('label').removeClass('warning');
            },1500);
        }else if (!document.getElementsByClassName('confirm')) {
            alert('이메일 인증 버튼을 눌러주세요');
            memberEmail.focus();
            return;
        } else if (random.val() == '' || random.val() !== authentication.val()) {
            alert("이메일 인증 코드를 확인해 주세요.");
            random.focus();
            return;
        } else if ($(memberName).val() == "") {
            $(memberName).next('label').addClass('warning');
            setTimeout(function () {
                $('label').removeClass('warning');
            }, 1500);
        } else if ($(memberPWD).val() == "") {
            $(memberPWD).next('label').addClass('warning');
            setTimeout(function () {
                $('label').removeClass('warning');
            }, 1500);
        } else if ($(passCheck).val() == "") {
            $(passCheck).next('label').addClass('warning');
            setTimeout(function () {
                $('label').removeClass('warning');
            }, 1500);
        } else if ($(passCheck).val() != $(memberPWD).val()) {
            $(passCheck).next('label').addClass('warning');
            passCheck.val('');
            alert("비밀번호가 일치하지 않습니다.");
            setTimeout(function () {
                $('label').removeClass('warning');
            }, 1500);
        } else if ($(address).val() == "") {
            $(address).next('label').addClass('warning');
            setTimeout(function () {
                $('label').removeClass('warning');
            }, 1500);
        } else if ($(addressDetail).val() == "") {
            $(addressDetail).next('label').addClass('warning');
            setTimeout(function () {
                $('label').removeClass('warning');
            }, 1500);
        }
        $('#form1').submit();

    });


</script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script th:src="@{/js/address.js}" type="text/javascript"></script>

</body>
</html>